# 实施任务清单

## 项目初始化

- [x] 1. 搭建Monorepo基础架构
  - 初始化pnpm workspace
  - 配置Turborepo (可选)
  - 设置根目录package.json和配置文件
  - 配置ESLint、Prettier、Husky
  - 设置VSCode工作区配置
  - _需求: 1.1, 1.2, 1.3_

- [x] 2. 创建共享包基础结构
  - [x] 2.1 创建shared-types包
    - 初始化TypeScript项目
    - 定义工作流、节点、执行相关类型
    - 配置类型导出
    - _需求: 1.2, 2.1_
  - [x] 2.2 创建shared-constants包
    - 定义节点类型常量
    - 定义状态码常量
    - 定义错误码常量
    - _需求: 1.2_
  - [x] 2.3 创建shared-utils包
    - 实现通用工具函数
    - 实现日期格式化函数
    - 实现验证工具
    - _需求: 1.2_
  - [x] 2.4 创建shared-validators包
    - 使用Zod定义验证schemas
    - 工作流定义验证
    - 节点配置验证
    - _需求: 1.2, 2.4_

## 前端应用开发

- [x] 3. 初始化Vue3前端项目
  - 使用Vite 7创建项目
  - 配置TypeScript 5.x
  - 配置Tailwind CSS 4
  - 集成Shadcn-vue组件
  - 配置Vue Router和Pinia
  - _需求: 2.1, 2.2, 8.1, 8.2_

- [x] 4. 实现认证功能
  - [x] 4.1 创建登录页面
    - 设计登录表单UI
    - 实现表单验证
    - 集成BFF登录API
    - _需求: 5.5_
  - [x] 4.2 创建注册页面
    - 设计注册表单UI
    - 实现密码强度验证
    - 集成BFF注册API
    - _需求: 5.5_
  - [x] 4.3 实现JWT token管理
    - 实现token存储
    - 实现token刷新机制
    - 实现自动登出
    - _需求: 5.5_
  - [x] 4.4 实现路由守卫
    - 创建认证守卫
    - 实现权限检查
    - 处理未授权跳转
    - _需求: 5.5_

- [x] 5. 实现流程编辑器核心功能
  - [x] 5.1 集成Vue Flow
    - 安装@vue-flow/core
    - 创建FlowCanvas组件
    - 配置基础样式
    - _需求: 2.1, 2.2_
  - [x] 5.2 实现节点面板
    - 创建NodePalette组件
    - 实现节点分类展示
    - 实现拖拽添加节点
    - _需求: 2.2, 2.3_
  - [x] 5.3 实现自定义节点组件
    - 创建InputNode组件
    - 创建LLMNode组件
    - 创建ConditionNode组件
    - 创建TransformNode组件
    - 创建OutputNode组件
    - _需求: 2.3_
  - [x] 5.4 实现属性配置面板
    - 创建PropertyPanel组件
    - 实现动态表单生成
    - 集成Zod验证
    - 实现实时保存
    - _需求: 2.2, 2.4_
  - [x] 5.5 实现工具栏功能
    - 创建Toolbar组件
    - 实现保存/加载功能
    - 实现撤销/重做
    - 实现缩放/适应画布
    - _需求: 2.2_

- [x] 6. 实现工作流管理功能
  - [x] 6.1 创建工作流列表页面
    - 设计列表UI
    - 实现分页和搜索
    - 集成BFF API
    - _需求: 6.1, 6.2_
  - [x] 6.2 实现工作流CRUD操作
    - 创建工作流
    - 更新工作流
    - 删除工作流
    - 克隆工作流
    - _需求: 6.1, 6.2_
  - [x] 6.3 实现工作流版本管理
    - 显示版本历史
    - 版本对比
    - 版本回滚
    - _需求: 6.3_

- [x] 7. 实现执行管理功能
  - [x] 7.1 创建执行触发界面
    - 设计输入参数表单
    - 实现执行触发
    - 显示执行状态
    - _需求: 3.4_
  - [x] 7.2 实现WebSocket实时通信
    - 集成Socket.io客户端
    - 订阅执行状态更新
    - 显示实时日志
    - 处理连接断开重连
    - _需求: 5.2_
  - [x] 7.3 创建执行历史页面
    - 显示执行列表
    - 实现筛选和搜索
    - 显示执行详情
    - _需求: 6.2_
  - [x] 7.4 实现执行结果可视化
    - 显示节点执行状态
    - 显示执行时间线
    - 显示错误信息
    - _需求: 3.4_

- [x] 8. 实现插件管理功能
  - [x] 8.1 创建插件市场页面
    - 显示可用插件列表
    - 实现插件搜索
    - 显示插件详情
    - _需求: 扩展性_
  - [x] 8.2 实现插件安装功能
    - 实现插件上传
    - 显示安装进度
    - 处理安装错误
    - _需求: 扩展性_
  - [x] 8.3 实现插件动态加载
    - 创建PluginLoader
    - 动态加载Vue组件
    - 注册自定义节点
    - _需求: 扩展性_

## BFF层开发 (NestJS)

- [x] 9. 初始化NestJS项目
  - 创建NestJS应用
  - 配置TypeScript
  - 集成Prisma ORM
  - 配置环境变量
  - 设置日志系统
  - _需求: 5.1, 5.5_

- [x] 10. 实现数据库层
  - [x] 10.1 设计Prisma Schema
    - 定义User模型
    - 定义Tenant模型
    - 定义Workflow模型
    - 定义Execution模型
    - 定义Permission模型
    - _需求: 6.1, 6.2, 6.3_
  - [x] 10.2 创建数据库迁移
    - 生成初始迁移
    - 创建种子数据
    - 测试迁移
    - _需求: 6.1_
  - [x] 10.3 实现Prisma Service
    - 创建PrismaService
    - 实现租户过滤中间件
    - 实现连接管理
    - _需求: 6.1, 多租户_

- [x] 11. 实现认证授权模块
  - [x] 11.1 创建Auth Module
    - 实现JWT策略
    - 实现本地策略
    - 创建AuthService
    - 创建AuthController
    - _需求: 5.5_
  - [x] 11.2 实现权限系统
    - 创建PermissionsGuard
    - 创建ResourceOwnerGuard
    - 实现RBAC逻辑
    - _需求: 5.5, 多租户_
  - [x] 11.3 实现租户中间件
    - 创建TenantMiddleware
    - 实现tenantId提取
    - 实现租户验证
    - _需求: 多租户_

- [x] 12. 实现工作流模块
  - [x] 12.1 创建Workflows Module
    - 创建WorkflowsService
    - 创建WorkflowsController
    - 实现CRUD操作
    - _需求: 5.1, 6.1, 6.2_
  - [x] 12.2 实现工作流验证
    - 验证工作流定义
    - 检查节点权限
    - 验证边连接
    - _需求: 2.4, 6.1_
  - [x] 12.3 实现工作流版本管理
    - 创建版本记录
    - 实现版本对比
    - 实现版本回滚
    - _需求: 6.3_

- [x] 13. 实现执行模块
  - [x] 13.1 创建Executions Module
    - 创建ExecutionsService
    - 创建ExecutionsController
    - 实现执行触发逻辑
    - _需求: 3.1, 3.2, 3.3_
  - [x] 13.2 实现AI Service客户端
    - 创建AiServiceClient
    - 实现HTTP调用
    - 实现错误处理
    - 实现重试机制
    - _需求: 3.1, 3.2_
  - [x] 13.3 实现WebSocket Gateway
    - 创建ExecutionsGateway
    - 实现事件推送
    - 实现房间管理
    - 处理连接认证
    - _需求: 5.2_
  - [x] 13.4 实现执行日志管理
    - 存储执行日志
    - 实现日志查询
    - 实现日志流式推送
    - _需求: 3.3_

- [x] 14. 实现租户管理模块
  - [x] 14.1 创建Tenants Module
    - 创建TenantsService
    - 创建TenantsController
    - 实现租户CRUD
    - _需求: 多租户_
  - [x] 14.2 实现租户资源初始化
    - 创建MinIO buckets
    - 初始化Redis命名空间
    - 创建默认角色
    - _需求: 多租户_
  - [x] 14.3 实现租户使用量统计
    - 统计工作流数量
    - 统计执行次数
    - 统计存储使用量
    - _需求: 多租户_

- [ ] 15. 实现插件管理模块
  - [ ] 15.1 创建Plugins Module
    - 创建PluginsService
    - 创建PluginsController
    - 实现插件注册
    - _需求: 扩展性_
  - [ ] 15.2 实现插件存储服务
    - 集成MinIO
    - 实现文件上传
    - 实现文件下载
    - _需求: 扩展性_
  - [ ] 15.3 实现插件验证
    - 验证manifest格式
    - 验证数字签名
    - 检查权限声明
    - _需求: 扩展性_
  - [ ] 15.4 实现插件安装流程
    - 解压插件包
    - 安装前端资源
    - 通知AI Service安装
    - 更新插件状态
    - _需求: 扩展性_

## AI服务开发 (Python)

- [x] 16. 初始化Python项目
  - 创建FastAPI应用
  - 配置Poetry依赖管理
  - 配置项目结构
  - 设置日志系统
  - _需求: 3.1, 3.2_

- [x] 17. 实现Ollama服务客户端
  - [x] 17.1 创建OllamaService
    - 实现HTTP客户端
    - 实现模型调用
    - 实现流式响应
    - _需求: 4.1, 4.2, 4.3_
  - [x] 17.2 实现连接池管理
    - 配置httpx连接池
    - 实现超时控制
    - 实现错误重试
    - _需求: 4.5_
  - [x] 17.3 实现模型管理
    - 获取模型列表
    - 拉取新模型
    - 获取模型信息
    - _需求: 4.1_

- [x] 18. 实现工作流引擎核心
  - [x] 18.1 创建WorkflowEngine
    - 实现工作流解析
    - 构建LangGraph执行图
    - 实现状态管理
    - _需求: 3.1, 3.2_
  - [x] 18.2 创建NodeExecutor基类
    - 定义执行接口
    - 实现配置验证
    - 实现错误处理
    - _需求: 3.2, 3.5_
  - [x] 18.3 实现ExecutionContext
    - 管理执行状态
    - 实现数据传递
    - 实现变量解析
    - _需求: 3.2, 3.3_

- [x] 19. 实现内置节点执行器
  - [x] 19.1 实现LLMNodeExecutor
    - 调用OllamaService
    - 处理提示词模板
    - 实现流式输出
    - _需求: 4.1, 4.2, 4.4_
  - [x] 19.2 实现ConditionNodeExecutor
    - 实现条件表达式解析
    - 实现分支逻辑
    - 处理多路分支
    - _需求: 3.2_
  - [x] 19.3 实现TransformNodeExecutor
    - 实现数据转换
    - 支持JavaScript表达式
    - 实现数据映射
    - _需求: 3.2_
  - [x] 19.4 实现InputNodeExecutor
    - 处理输入数据
    - 实现数据验证
    - 实现默认值
    - _需求: 3.2_
  - [x] 19.5 实现OutputNodeExecutor
    - 格式化输出数据
    - 实现数据过滤
    - 返回执行结果
    - _需求: 3.2_

- [x] 20. 实现执行API
  - [x] 20.1 创建执行端点
    - POST /api/v1/execute
    - 接收工作流定义
    - 触发异步执行
    - _需求: 3.1, 3.4_
  - [x] 20.2 实现执行状态管理
    - 更新执行状态
    - 记录执行日志
    - 处理执行错误
    - _需求: 3.3, 3.5_
  - [x] 20.3 实现执行控制
    - 实现暂停功能
    - 实现恢复功能
    - 实现停止功能
    - _需求: 3.4_

- [ ] 21. 实现插件系统
  - [ ] 21.1 创建PluginRegistry
    - 实现插件注册
    - 实现执行器查找
    - 管理插件生命周期
    - _需求: 扩展性_
  - [ ] 21.2 实现插件加载器
    - 动态导入Python模块
    - 安装插件依赖
    - 验证插件接口
    - _需求: 扩展性_
  - [ ] 21.3 实现插件API
    - POST /api/v1/plugins/install
    - GET /api/v1/plugins
    - DELETE /api/v1/plugins/:id
    - _需求: 扩展性_

## 监控与可观测性

- [ ] 22. 实现Prometheus监控
  - [ ] 22.1 集成Prometheus客户端
    - BFF集成prom-client
    - AI Service集成prometheus_client
    - 配置metrics端点
    - _需求: 监控_
  - [ ] 22.2 定义核心指标
    - 工作流执行指标
    - 节点执行指标
    - LLM调用指标
    - 系统资源指标
    - _需求: 监控_
  - [ ] 22.3 实现指标收集
    - 在关键路径添加指标
    - 实现自定义标签
    - 配置指标聚合
    - _需求: 监控_

- [ ] 23. 实现分布式追踪
  - [ ] 23.1 集成OpenTelemetry
    - BFF集成@opentelemetry/sdk-node
    - AI Service集成opentelemetry-python
    - 配置Jaeger exporter
    - _需求: 监控_
  - [ ] 23.2 实现跨服务追踪
    - 实现trace context传递
    - 添加自定义span
    - 配置采样策略
    - _需求: 监控_

- [ ] 24. 配置Grafana Dashboard
  - 创建工作流监控面板
  - 创建系统性能面板
  - 创建错误追踪面板
  - 配置告警规则
  - _需求: 监控_

- [ ] 25. 实现日志聚合
  - [ ] 25.1 配置结构化日志
    - BFF使用Winston
    - AI Service使用structlog
    - 统一日志格式
    - _需求: 监控_
  - [ ] 25.2 集成ELK Stack (可选)
    - 配置Elasticsearch
    - 配置Logstash
    - 配置Kibana
    - _需求: 监控_

## Docker容器化

- [x] 26. 创建Docker镜像
  - [x] 26.1 创建前端Dockerfile
    - 多阶段构建
    - 优化镜像大小
    - 配置Nginx
    - _需求: 7.1, 7.4_
  - [x] 26.2 创建BFF Dockerfile
    - Node.js基础镜像
    - 安装依赖
    - 配置启动脚本
    - _需求: 7.1, 7.4_
  - [x] 26.3 创建AI Service Dockerfile
    - Python基础镜像
    - 安装依赖
    - 配置启动脚本
    - _需求: 7.1, 7.4_

- [x] 27. 配置Docker Compose
  - [x] 27.1 创建生产环境配置
    - 配置所有服务
    - 配置网络
    - 配置卷挂载
    - _需求: 7.1, 7.2, 7.3_
  - [x] 27.2 创建开发环境配置
    - 配置热重载
    - 配置调试端口
    - 简化服务依赖
    - _需求: 7.1_

- [x] 28. 配置Nginx反向代理
  - 配置路由规则
  - 配置SSL证书
  - 配置负载均衡
  - 配置WebSocket代理
  - _需求: 7.1, 7.7_

## 测试

- [ ] 29. 前端测试
  - [ ] 29.1 编写组件单元测试
    - 测试节点组件
    - 测试表单组件
    - 测试工具函数
    - _需求: 8.9_
  - [ ] 29.2 编写Store测试
    - 测试workflowStore
    - 测试executionStore
    - 测试authStore
    - _需求: 8.9_

- [ ] 30. BFF测试
  - [ ] 30.1 编写单元测试
    - 测试Service层
    - 测试Guard
    - 测试工具函数
    - _需求: 8.9_
  - [ ] 30.2 编写集成测试
    - 测试API端点
    - 测试数据库操作
    - 测试WebSocket
    - _需求: 8.9_

- [ ] 31. AI Service测试
  - [ ] 31.1 编写单元测试
    - 测试节点执行器
    - 测试工作流引擎
    - 测试Ollama客户端
    - _需求: 8.9_
  - [ ] 31.2 编写工作流测试
    - 测试简单工作流
    - 测试条件分支
    - 测试循环逻辑
    - _需求: 8.9_

## 文档与部署

- [ ] 32. 编写文档
  - 编写README
  - 编写API文档
  - 编写部署指南
  - 编写插件开发指南
  - _需求: 1.4, 9.4_

- [ ] 33. 配置CI/CD
  - 配置GitHub Actions
  - 配置自动化测试
  - 配置自动化部署
  - 配置代码质量检查
  - _需求: 9.5_

- [ ] 34. 生产环境部署
  - 配置数据库
  - 部署服务
  - 配置监控
  - 配置备份
  - _需求: 7.2, 7.3, 7.6_
